version: v2beta1
name: homelab306-k8s-infra


vars:
  CLUSTER_ISSUER_DNS_AWS_ACCESS_KEY_ID:
    alwaysResolve: true
  CLUSTER_ISSUER_DNS_AWS_SECRET_ACCESS_KEY:
    alwaysResolve: true

deployments:
  cert-manager:
    namespace: cert-manager
    helm:
      chart:
        name: cert-manager
        repo: https://charts.jetstack.io
      values:
        installCRDs: true

  core-infra:
    namespace: core-infra
    helm:
      chart:
        name: ./core
      valuesFiles:
        - ./core/values.yaml
      values:
        certManager:
          awsAccessKeyId: ${CLUSTER_ISSUER_DNS_AWS_ACCESS_KEY_ID}
          awsSecretAccessKey: ${CLUSTER_ISSUER_DNS_AWS_SECRET_ACCESS_KEY}

  kubernetes-dashboard:
    namespace: kubernetes-dashboard
    helm:
      chart:
        name: kubernetes-dashboard
        repo: https://kubernetes.github.io/dashboard/
      values:
        serviceAccount:
          create: true
          name: kubernetes-dashboard
        kong:
          proxy:
            http:
              enabled: true
        app:
          ingress:
            enabled: true
            annotations:
              cert-manager.io/cluster-issuer: "letsencrypt-prod"
              traefik.ingress.kubernetes.io/router.tls: "true"
            hosts:
              - dashboard.court306.com
            useDefaultIngressClass: true
            pathType: ImplementationSpecific
            path: /
            issuer:
              scope: disabled
            tls:
              enabled: true
